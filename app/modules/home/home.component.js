"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const core_1 = require("@angular/core");
const lot_model_1 = require("../shared/lot/lot.model");
var Sqlite = require("nativescript-sqlite");
let HomeComponent = class HomeComponent {
    constructor() {
        this.text = 'Buyer\'s Account Calculation';
        this.baLot = new lot_model_1.Lot();
        this.baLot.lotSizeSQM = 0;
        this.baLot.FMV = 0;
        this.baLot.sellPrice = 0;
        this.baLot.zonalValue = 0;
    }
    submit() {
        if (this.baLot.sellPrice != 0) {
            this.lotCalc();
        }
    }
    lotCalc() {
        this.fetchdata(this.baLot.sellPrice);
    }
    fetchdata(vsellPrice) {
        var vregFee;
        var vcutOff;
        var vincrement;
        var vextraFee;
        var vaddlFee;
        var vincFact;
        var aregFees;
        if (!Sqlite.exists("regfees.db")) {
            Sqlite.copyDatabase("regfees.db");
        }
        (new Sqlite("regfees.db")).then(db => {
            this.database = db;
            this.database.resultType(db.RESULTASOBJECT);
            this.database.valueType(db.VALUESARENATIVE);
            this.database.get("select regfee, cutoff, increment, extrafee from regfee where sprcll <= ? and sprcul > ?", [vsellPrice, vsellPrice]).then(row => {
                aregFees = row;
                vregFee = aregFees[0];
                vcutOff = aregFees[1];
                vincrement = aregFees[2];
                vextraFee = aregFees[3];
                if (vcutOff != 0) {
                    vincFact = Math.round((vsellPrice - vcutOff) / vincrement);
                    if ((vsellPrice - vcutOff) % vincrement < 5) {
                        vincFact += 1;
                    }
                    vaddlFee = vincFact * vextraFee;
                    vregFee += vaddlFee;
                }
                this.baLot.registration = Number(vregFee);
                if (Number.isNaN(this.baLot.lotSizeSQM) || (this.baLot.lotSizeSQM === 0)) {
                    this.baLot.pricePerSQM = 0;
                }
                else {
                    this.baLot.pricePerSQM = Number((this.baLot.sellPrice / this.baLot.lotSizeSQM).toFixed(2));
                }
                this.baLot.transferTax = Number((Math.max(this.baLot.FMV, this.baLot.sellPrice) * 0.5 * 0.01).toFixed(2));
                this.baLot.totalAmt = +this.baLot.sellPrice + +this.baLot.registration + +this.baLot.transferTax;
                if (this.database.isOpen()) {
                    this.database.close();
                }
            }, error => {
                return error;
            });
        }, error => {
            console.log("OPEN DB ERROR", error);
        });
    }
};
HomeComponent = __decorate([
    core_1.Component({
        selector: 'home',
        templateUrl: 'modules/home/home.component.html',
        changeDetection: core_1.ChangeDetectionStrategy.Default
    }),
    __metadata("design:paramtypes", [])
], HomeComponent);
exports.HomeComponent = HomeComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaG9tZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJob21lLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHdDQUFtRTtBQUNuRSx1REFBOEM7QUFDOUMsSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLHFCQUFxQixDQUFDLENBQUM7QUFRNUMsSUFBYSxhQUFhLEdBQTFCO0lBSUU7UUFIQSxTQUFJLEdBQVcsOEJBQThCLENBQUM7UUFJNUMsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLGVBQUcsRUFBRSxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxLQUFLLENBQUMsVUFBVSxHQUFHLENBQUMsQ0FBQztRQUMxQixJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUM7UUFDbkIsSUFBSSxDQUFDLEtBQUssQ0FBQyxTQUFTLEdBQUcsQ0FBQyxDQUFDO1FBQ3pCLElBQUksQ0FBQyxLQUFLLENBQUMsVUFBVSxHQUFHLENBQUMsQ0FBQztJQUM1QixDQUFDO0lBRUQsTUFBTTtRQUNKLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDOUIsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ2pCLENBQUM7SUFDSCxDQUFDO0lBRUQsT0FBTztRQUNMLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUN2QyxDQUFDO0lBSU0sU0FBUyxDQUFDLFVBQWU7UUFDNUIsSUFBSSxPQUFlLENBQUM7UUFDcEIsSUFBSSxPQUFlLENBQUM7UUFDcEIsSUFBSSxVQUFrQixDQUFDO1FBQ3ZCLElBQUksU0FBaUIsQ0FBQztRQUN0QixJQUFJLFFBQWdCLENBQUM7UUFDckIsSUFBSSxRQUFnQixDQUFDO1FBQ3JCLElBQUksUUFBdUIsQ0FBQztRQUU1QixFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FB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LENBQUM7Z0JBQ3hCLENBQUM7WUFFTCxDQUFDLEVBQUUsS0FBSztnQkFDSixNQUFNLENBQUMsS0FBSyxDQUFDO1lBQ2pCLENBQUMsQ0FBQyxDQUFDO1FBQ1AsQ0FBQyxFQUFFLEtBQUs7WUFDTixPQUFPLENBQUMsR0FBRyxDQUFDLGVBQWUsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUN0QyxDQUFDLENBQUMsQ0FBQztJQUVMLENBQUM7Q0FFSixDQUFBO0FBaEZZLGFBQWE7SUFOekIsZ0JBQVMsQ0FBQztRQUNULFFBQVEsRUFBRSxNQUFNO1FBQ2hCLFdBQVcsRUFBRSxrQ0FBa0M7UUFDL0MsZUFBZSxFQUFFLDhCQUF1QixDQUFDLE9BQU87S0FDakQsQ0FBQzs7R0FFVyxhQUFhLENBZ0Z6QjtBQWhGWSxzQ0FBYSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgTG90IH0gZnJvbSAnLi4vc2hhcmVkL2xvdC9sb3QubW9kZWwnO1xyXG52YXIgU3FsaXRlID0gcmVxdWlyZShcIm5hdGl2ZXNjcmlwdC1zcWxpdGVcIik7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2hvbWUnLFxyXG4gIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9ob21lL2hvbWUuY29tcG9uZW50Lmh0bWwnLFxyXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuRGVmYXVsdFxyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIEhvbWVDb21wb25lbnQge1xyXG4gIHRleHQ6IHN0cmluZyA9ICdCdXllclxcJ3MgQWNjb3VudCBDYWxjdWxhdGlvbic7XHJcbiAgYmFMb3Q6IExvdDtcclxuXHJcbiAgY29uc3RydWN0b3IoKXtcclxuICAgIHRoaXMuYmFMb3QgPSBuZXcgTG90KCk7XHJcbiAgICB0aGlzLmJhTG90LmxvdFNpemVTUU0gPSAwO1xyXG4gICAgdGhpcy5iYUxvdC5GTVYgPSAwO1xyXG4gICAgdGhpcy5iYUxvdC5zZWxsUHJpY2UgPSAwO1xyXG4gICAgdGhpcy5iYUxvdC56b25hbFZhbHVlID0gMDtcclxuICB9XHJcblxyXG4gIHN1Ym1pdCgpe1xyXG4gICAgaWYgKHRoaXMuYmFMb3Quc2VsbFByaWNlICE9IDApIHtcclxuICAgICAgdGhpcy5sb3RDYWxjKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBsb3RDYWxjKCkge1xyXG4gICAgdGhpcy5mZXRjaGRhdGEodGhpcy5iYUxvdC5zZWxsUHJpY2UpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBkYXRhYmFzZTogYW55O1xyXG4gICAgXHJcbiAgcHVibGljIGZldGNoZGF0YSh2c2VsbFByaWNlOiBhbnkgKSB7XHJcbiAgICAgIHZhciB2cmVnRmVlOiBudW1iZXI7XHJcbiAgICAgIHZhciB2Y3V0T2ZmOiBudW1iZXI7XHJcbiAgICAgIHZhciB2aW5jcmVtZW50OiBudW1iZXI7XHJcbiAgICAgIHZhciB2ZXh0cmFGZWU6IG51bWJlcjtcclxuICAgICAgdmFyIHZhZGRsRmVlOiBudW1iZXI7XHJcbiAgICAgIHZhciB2aW5jRmFjdDogbnVtYmVyO1xyXG4gICAgICB2YXIgYXJlZ0ZlZXM6IEFycmF5PG51bWJlcj47XHJcblxyXG4gICAgICBpZiAoIVNxbGl0ZS5leGlzdHMoXCJyZWdmZWVzLmRiXCIpKSB7XHJcbiAgICAgIFNxbGl0ZS5jb3B5RGF0YWJhc2UoXCJyZWdmZWVzLmRiXCIpO1xyXG4gICAgICB9XHJcbiAgICAgICAgKG5ldyBTcWxpdGUoXCJyZWdmZWVzLmRiXCIpKS50aGVuKGRiID0+IHtcclxuICAgICAgICAgIHRoaXMuZGF0YWJhc2UgPSBkYjtcclxuICAgICAgICAgIHRoaXMuZGF0YWJhc2UucmVzdWx0VHlwZShkYi5SRVNVTFRBU09CSkVDVCk7XHJcbiAgICAgICAgICB0aGlzLmRhdGFiYXNlLnZhbHVlVHlwZShkYi5WQUxVRVNBUkVOQVRJVkUpO1xyXG4gICAgICBcclxuICAgICAgICAgIHRoaXMuZGF0YWJhc2UuZ2V0KFwic2VsZWN0IHJlZ2ZlZSwgY3V0b2ZmLCBpbmNyZW1lbnQsIGV4dHJhZmVlIGZyb20gcmVnZmVlIHdoZXJlIHNwcmNsbCA8PSA/IGFuZCBzcHJjdWwgPiA/XCIsIFt2c2VsbFByaWNlLHZzZWxsUHJpY2VdKS50aGVuKHJvdz0+IHtcclxuICAgICAgICAgICAgICBhcmVnRmVlcyA9IHJvdztcclxuICAgICAgICAgICAgICB2cmVnRmVlID0gYXJlZ0ZlZXNbMF07XHJcbiAgICAgICAgICAgICAgdmN1dE9mZiA9IGFyZWdGZWVzWzFdO1xyXG4gICAgICAgICAgICAgIHZpbmNyZW1lbnQgPSBhcmVnRmVlc1syXTtcclxuICAgICAgICAgICAgICB2ZXh0cmFGZWUgPSBhcmVnRmVlc1szXTtcclxuXHJcbiAgICAgICAgICAgICAgaWYgKHZjdXRPZmYgIT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICB2aW5jRmFjdCA9IE1hdGgucm91bmQoKHZzZWxsUHJpY2UtdmN1dE9mZikvdmluY3JlbWVudCk7XHJcbiAgICAgICAgICAgICAgICAgIGlmICgodnNlbGxQcmljZS12Y3V0T2ZmKSAlIHZpbmNyZW1lbnQgPCA1KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICB2aW5jRmFjdCArPSAxO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgIHZhZGRsRmVlID0gdmluY0ZhY3QgKiB2ZXh0cmFGZWU7XHJcbiAgICAgICAgICAgICAgICAgIHZyZWdGZWUgKz0gdmFkZGxGZWU7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICB0aGlzLmJhTG90LnJlZ2lzdHJhdGlvbj1OdW1iZXIodnJlZ0ZlZSk7XHJcbiAgICAgICAgICAgICAgaWYgKE51bWJlci5pc05hTih0aGlzLmJhTG90LmxvdFNpemVTUU0pfHwodGhpcy5iYUxvdC5sb3RTaXplU1FNID09PSAwKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5iYUxvdC5wcmljZVBlclNRTSA9IDA7XHJcbiAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYmFMb3QucHJpY2VQZXJTUU0gPSBOdW1iZXIoKHRoaXMuYmFMb3Quc2VsbFByaWNlL3RoaXMuYmFMb3QubG90U2l6ZVNRTSkudG9GaXhlZCgyKSk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIHRoaXMuYmFMb3QudHJhbnNmZXJUYXggPSBOdW1iZXIoKE1hdGgubWF4KHRoaXMuYmFMb3QuRk1WLHRoaXMuYmFMb3Quc2VsbFByaWNlKSowLjUqMC4wMSkudG9GaXhlZCgyKSk7XHJcblxyXG4gICAgICAgICAgICAgIHRoaXMuYmFMb3QudG90YWxBbXQgPSArdGhpcy5iYUxvdC5zZWxsUHJpY2UgKyArdGhpcy5iYUxvdC5yZWdpc3RyYXRpb24gKyArdGhpcy5iYUxvdC50cmFuc2ZlclRheDtcclxuXHJcbiAgICAgICAgICAgICAgaWYgKHRoaXMuZGF0YWJhc2UuaXNPcGVuKCkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGF0YWJhc2UuY2xvc2UoKTtcclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgfSwgZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICAgIHJldHVybiBlcnJvcjtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICB9LCBlcnJvciA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJPUEVOIERCIEVSUk9SXCIsIGVycm9yKTtcclxuICAgICAgfSk7XHJcbiAgICAgICAgXHJcbiAgICB9XHJcblxyXG59Il19